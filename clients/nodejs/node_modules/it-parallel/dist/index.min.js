(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ItParallel = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ItParallel=(()=>{var h=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var x=(t,r)=>{for(var l in r)h(t,l,{get:r[l],enumerable:!0})},C=(t,r,l,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of g(r))!A.call(t,n)&&n!==l&&h(t,n,{get:()=>r[n],enumerable:!(c=b(r,n))||c.enumerable});return t};var I=t=>C(h({},"__esModule",{value:!0}),t);var O={};x(O,{default:()=>y});function a(){let t={};return t.promise=new Promise((r,l)=>{t.resolve=r,t.reject=l}),t}var d=globalThis.CustomEvent??Event;async function*y(t,r={}){let l=r.concurrency??1/0;l<1&&(l=1/0);let c=r.ordered??!1,n=new EventTarget,o=[],i=a(),f=a(),m=!1,u,v=!1;n.addEventListener("task-complete",()=>{f.resolve()}),Promise.resolve().then(async()=>{try{for await(let e of t){if(o.length===l&&(i=a(),await i.promise),v)break;let s={done:!1};o.push(s),e().then(p=>{s.done=!0,s.ok=!0,s.value=p,n.dispatchEvent(new d("task-complete"))},p=>{s.done=!0,s.err=p,n.dispatchEvent(new d("task-complete"))})}m=!0,n.dispatchEvent(new d("task-complete"))}catch(e){u=e,n.dispatchEvent(new d("task-complete"))}});function w(){return c?o[0]?.done:!!o.find(e=>e.done)}function*k(){for(;o.length>0&&o[0].done;){let e=o[0];if(o.shift(),e.ok)yield e.value;else throw v=!0,i.resolve(),e.err;i.resolve()}}function*E(){for(;w();)for(let e=0;e<o.length;e++)if(o[e].done){let s=o[e];if(o.splice(e,1),e--,s.ok)yield s.value;else throw v=!0,i.resolve(),s.err;i.resolve()}}for(;;){if(w()||(f=a(),await f.promise),u!=null)throw u;if(c?yield*k():yield*E(),m&&o.length===0)break}}return I(O);})();
return ItParallel}));
